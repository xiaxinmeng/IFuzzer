with lock:
  BLOCK1
  with invert(lock):
    BLOCK2
  BLOCK3