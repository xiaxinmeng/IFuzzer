with optional_cm(sync_lock), optional_cm(db_transaction), \
     open(fname) as f:
    ...